<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase é…ç½®æª¢æŸ¥</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .info {
            background: #cce5ff;
            color: #004085;
            border: 1px solid #99ccff;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .config-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¥ Firebase é…ç½®æª¢æŸ¥å·¥å…·</h1>
        <p>é€™å€‹å·¥å…·å¯ä»¥å¹«åŠ©æ‚¨æª¢æŸ¥ Firebase é…ç½®æ˜¯å¦æ­£ç¢ºè¨­å®šã€‚</p>
        
        <div id="statusContainer">
            <div class="info">
                <strong>æº–å‚™æª¢æŸ¥...</strong><br>
                é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹æª¢æŸ¥ Firebase é…ç½®
            </div>
        </div>
        
        <div>
            <button onclick="checkFirebaseConfig()">æª¢æŸ¥ Firebase é…ç½®</button>
            <button onclick="testAuth()">æ¸¬è©¦ Google ç™»å…¥</button>
            <button onclick="testFirestore()">æ¸¬è©¦ Firestore é€£æ¥</button>
            <button onclick="showConfig()">é¡¯ç¤ºç•¶å‰é…ç½®</button>
        </div>
        
        <div id="configDisplay" class="config-display" style="display: none;"></div>
        
        <div class="info">
            <h3>ä½¿ç”¨èªªæ˜ï¼š</h3>
            <ol>
                <li><strong>æª¢æŸ¥ Firebase é…ç½®</strong> - é©—è­‰ Firebase æ˜¯å¦æ­£ç¢ºåˆå§‹åŒ–</li>
                <li><strong>æ¸¬è©¦ Google ç™»å…¥</strong> - æ¸¬è©¦ Authentication åŠŸèƒ½</li>
                <li><strong>æ¸¬è©¦ Firestore é€£æ¥</strong> - æ¸¬è©¦è³‡æ–™åº«é€£æ¥</li>
                <li><strong>é¡¯ç¤ºç•¶å‰é…ç½®</strong> - é¡¯ç¤ºç›®å‰çš„ Firebase é…ç½®ï¼ˆéš±è—æ•æ„Ÿè³‡è¨Šï¼‰</li>
            </ol>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, connectFirestoreEmulator } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // ä½¿ç”¨èˆ‡ä¸»ç¨‹å¼ç›¸åŒçš„é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyDemoKeyForTesting1234567890",
            authDomain: "accounting-wallet-app.firebaseapp.com",
            projectId: "accounting-wallet-app",
            storageBucket: "accounting-wallet-app.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890"
        };
        
        let app, db, auth;
        
        function addStatus(message, type = 'info') {
            const container = document.getElementById('statusContainer');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }
        
        window.checkFirebaseConfig = async function() {
            try {
                addStatus('é–‹å§‹æª¢æŸ¥ Firebase é…ç½®...', 'info');
                
                // æª¢æŸ¥é…ç½®
                if (!firebaseConfig.apiKey || firebaseConfig.apiKey === "your-api-key") {
                    addStatus('âŒ Firebase é…ç½®å°šæœªè¨­å®šï¼è«‹æ›´æ–°æ‚¨çš„ API Key', 'error');
                    return;
                }
                
                if (!firebaseConfig.projectId || firebaseConfig.projectId === "your-project-id") {
                    addStatus('âŒ å°ˆæ¡ˆ ID å°šæœªè¨­å®šï¼', 'error');
                    return;
                }
                
                // åˆå§‹åŒ– Firebase
                app = initializeApp(firebaseConfig);
                addStatus('âœ… Firebase æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–æˆåŠŸ', 'success');
                
                // åˆå§‹åŒ–æœå‹™
                db = getFirestore(app);
                auth = getAuth(app);
                
                addStatus('âœ… Firestore å’Œ Auth æœå‹™åˆå§‹åŒ–æˆåŠŸ', 'success');
                addStatus('ğŸ‰ Firebase é…ç½®æª¢æŸ¥å®Œæˆï¼', 'success');
                
            } catch (error) {
                addStatus(`âŒ Firebase é…ç½®éŒ¯èª¤: ${error.message}`, 'error');
                console.error('Firebase é…ç½®éŒ¯èª¤:', error);
            }
        };
        
        window.testAuth = async function() {
            try {
                if (!auth) {
                    addStatus('âš ï¸ è«‹å…ˆæª¢æŸ¥ Firebase é…ç½®', 'warning');
                    return;
                }
                
                addStatus('é–‹å§‹æ¸¬è©¦ Google ç™»å…¥...', 'info');
                const provider = new GoogleAuthProvider();
                const result = await signInWithPopup(auth, provider);
                
                addStatus(`âœ… ç™»å…¥æˆåŠŸï¼æ­¡è¿ ${result.user.displayName}`, 'success');
                
            } catch (error) {
                if (error.code === 'auth/popup-closed-by-user') {
                    addStatus('â„¹ï¸ ç™»å…¥è¦–çª—è¢«ä½¿ç”¨è€…é—œé–‰', 'info');
                } else if (error.code === 'auth/unauthorized-domain') {
                    addStatus('âŒ ç¶²åŸŸæœªæˆæ¬Šï¼Œè«‹åœ¨ Firebase Console ä¸­æ·»åŠ æ­¤ç¶²åŸŸåˆ°æˆæ¬Šç¶²åŸŸæ¸…å–®', 'error');
                } else {
                    addStatus(`âŒ ç™»å…¥å¤±æ•—: ${error.message}`, 'error');
                }
                console.error('ç™»å…¥éŒ¯èª¤:', error);
            }
        };
        
        window.testFirestore = async function() {
            try {
                if (!db) {
                    addStatus('âš ï¸ è«‹å…ˆæª¢æŸ¥ Firebase é…ç½®', 'warning');
                    return;
                }
                
                addStatus('é–‹å§‹æ¸¬è©¦ Firestore é€£æ¥...', 'info');
                
                // å˜—è©¦å–å¾— Firestore è¨­å®šï¼ˆé€™ä¸æœƒå¯¦éš›å¯«å…¥è³‡æ–™ï¼‰
                const settings = db._settings;
                addStatus('âœ… Firestore é€£æ¥æˆåŠŸ', 'success');
                addStatus(`ğŸ“ è³‡æ–™åº«ä¸»æ©Ÿ: ${settings.host || 'firestore.googleapis.com'}`, 'info');
                
            } catch (error) {
                addStatus(`âŒ Firestore é€£æ¥å¤±æ•—: ${error.message}`, 'error');
                console.error('Firestore éŒ¯èª¤:', error);
            }
        };
        
        window.showConfig = function() {
            const configDisplay = document.getElementById('configDisplay');
            
            // éš±è—æ•æ„Ÿè³‡è¨Šçš„é…ç½®
            const safeConfig = {
                apiKey: firebaseConfig.apiKey.substring(0, 10) + "...",
                authDomain: firebaseConfig.authDomain,
                projectId: firebaseConfig.projectId,
                storageBucket: firebaseConfig.storageBucket,
                messagingSenderId: firebaseConfig.messagingSenderId.substring(0, 6) + "...",
                appId: firebaseConfig.appId.substring(0, 15) + "..."
            };
            
            configDisplay.textContent = `ç›®å‰çš„ Firebase é…ç½®:
${JSON.stringify(safeConfig, null, 2)}

æ³¨æ„ï¼šç‚ºäº†å®‰å…¨è€ƒé‡ï¼Œéƒ¨åˆ†è³‡è¨Šå·²éš±è—`;
            configDisplay.style.display = 'block';
            
            addStatus('ğŸ“‹ é…ç½®è³‡è¨Šå·²é¡¯ç¤ºï¼ˆéƒ¨åˆ†è³‡è¨Šå·²éš±è—ï¼‰', 'info');
        };
        
        // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºåˆå§‹ç‹€æ…‹
        window.addEventListener('load', function() {
            addStatus('Firebase é…ç½®æª¢æŸ¥å·¥å…·å·²å°±ç·’', 'info');
            
            if (firebaseConfig.apiKey === "AIzaSyDemoKeyForTesting1234567890") {
                addStatus('âš ï¸ ç›®å‰ä½¿ç”¨çš„æ˜¯æ¸¬è©¦é…ç½®ï¼Œè«‹æ›´æ–°ç‚ºæ‚¨çš„å¯¦éš› Firebase å°ˆæ¡ˆé…ç½®', 'warning');
            }
        });
        
    </script>
</body>
</html>
