<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿ Firebase è¨ºæ–·</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .error { background: #ffebee; color: #c62828; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .success { background: #e8f5e8; color: #2e7d32; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .warning { background: #fff3e0; color: #ef6c00; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .info { background: #e3f2fd; color: #1565c0; padding: 15px; border-radius: 5px; margin: 10px 0; }
        button { padding: 15px 30px; margin: 10px 5px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; }
        .primary { background: #1976d2; color: white; }
        .secondary { background: #757575; color: white; }
        .log { background: #f8f9fa; padding: 15px; font-family: monospace; font-size: 12px; border-radius: 5px; max-height: 200px; overflow-y: auto; }
        h1 { color: #333; text-align: center; }
        h2 { color: #555; border-bottom: 2px solid #eee; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¥ Firebase Google ç™»å…¥å•é¡Œè¨ºæ–·</h1>
        
        <div class="error">
            <h3>âŒ ç™¼ç¾å•é¡Œï¼šCORS å’Œ 404 éŒ¯èª¤</h3>
            <p>é€™è¡¨ç¤º Firebase å°ˆæ¡ˆçš„æˆæ¬Šç¶²åŸŸé…ç½®å¯èƒ½æœ‰å•é¡Œï¼Œæˆ–è€…å°ˆæ¡ˆè¨­å®šä¸æ­£ç¢ºã€‚</p>
        </div>
        
        <h2>ğŸ” å¿«é€Ÿè¨ºæ–·</h2>
        <button class="primary" onclick="testGoogleAuth()">æ¸¬è©¦ Google ç™»å…¥</button>
        <button class="secondary" onclick="checkDomainAuth()">æª¢æŸ¥ç¶²åŸŸæˆæ¬Š</button>
        <button class="secondary" onclick="testDirectGoogleOAuth()">ç¹é Firebase æ¸¬è©¦</button>
        
        <div id="results"></div>
        <div class="log" id="log"></div>
        
        <h2>ğŸ› ï¸ å¯èƒ½çš„è§£æ±ºæ–¹æ¡ˆ</h2>
        
        <div class="warning">
            <h4>1. Firebase å°ˆæ¡ˆæˆæ¬Šç¶²åŸŸå•é¡Œ</h4>
            <p>éœ€è¦åœ¨ Firebase Console ä¸­æ·»åŠ æˆæ¬Šç¶²åŸŸï¼š</p>
            <ul>
                <li>å‰å¾€ <strong>Firebase Console â†’ Authentication â†’ Settings â†’ Authorized domains</strong></li>
                <li>ç¢ºèªå·²æ·»åŠ ï¼š<code>hotdogcat0228.github.io</code></li>
                <li>ä¹Ÿå»ºè­°æ·»åŠ ï¼š<code>localhost</code> (æ¸¬è©¦ç”¨)</li>
            </ul>
        </div>
        
        <div class="info">
            <h4>2. Google Cloud Console OAuth è¨­å®š</h4>
            <p>æª¢æŸ¥ Google Cloud Console çš„ OAuth 2.0 è¨­å®šï¼š</p>
            <ul>
                <li>å‰å¾€ <strong>Google Cloud Console â†’ APIs & Services â†’ Credentials</strong></li>
                <li>æ‰¾åˆ°æ‚¨çš„ OAuth 2.0 ç”¨æˆ¶ç«¯ ID</li>
                <li>ç¢ºèªã€Œå·²æˆæ¬Šçš„ JavaScript ä¾†æºã€åŒ…å«ï¼š
                    <ul>
                        <li><code>https://hotdogcat0228.github.io</code></li>
                    </ul>
                </li>
                <li>ç¢ºèªã€Œå·²æˆæ¬Šçš„é‡æ–°å°å‘ URIã€åŒ…å«ï¼š
                    <ul>
                        <li><code>https://hotdogcat0228.github.io/accounting</code></li>
                        <li><code>https://hotdogcat0228.github.io/accounting/</code></li>
                    </ul>
                </li>
            </ul>
        </div>
        
        <div class="warning">
            <h4>3. Firebase å°ˆæ¡ˆç‹€æ…‹</h4>
            <p>ç¢ºèª Firebase å°ˆæ¡ˆæ­£å¸¸é‹ä½œï¼š</p>
            <ul>
                <li>å‰å¾€ <strong>Firebase Console â†’ Project Settings</strong></li>
                <li>æª¢æŸ¥å°ˆæ¡ˆ ID æ˜¯å¦æ­£ç¢ºï¼š<code>my-wallet-app-815ce</code></li>
                <li>ç¢ºèª Authentication åŠŸèƒ½å·²å•Ÿç”¨</li>
                <li>ç¢ºèª Google ç™»å…¥æä¾›è€…å·²å•Ÿç”¨</li>
            </ul>
        </div>
        
        <div class="error">
            <h4>4. ç«‹å³ä¿®å¾©å»ºè­°</h4>
            <p>è«‹åŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿï¼š</p>
            <ol>
                <li><strong>å‰å¾€ Firebase Console</strong> â†’ æ‚¨çš„å°ˆæ¡ˆ</li>
                <li><strong>Authentication</strong> â†’ <strong>Settings</strong> â†’ <strong>Authorized domains</strong></li>
                <li><strong>æ·»åŠ ç¶²åŸŸ</strong>ï¼š<code>hotdogcat0228.github.io</code></li>
                <li><strong>å„²å­˜</strong>å¾Œç­‰å¾… 5-10 åˆ†é˜è®“è¨­å®šç”Ÿæ•ˆ</li>
                <li><strong>æ¸…é™¤ç€è¦½å™¨ç·©å­˜</strong>ä¸¦é‡æ–°æ¸¬è©¦</li>
            </ol>
        </div>
    </div>

    <script type="module">
        const firebaseConfig = {
            apiKey: "AIzaSyB1DXR1TC11ZDhIXAeyWyn0gXnxaYW6Cjs",
            authDomain: "my-wallet-app-815ce.firebaseapp.com",
            projectId: "my-wallet-app-815ce",
            storageBucket: "my-wallet-app-815ce.firebasestorage.app",
            messagingSenderId: "656225813708",
            appId: "1:656225813708:web:2acd800eedd53408b4ae69",
            measurementId: "G-Z9MECGE7T0"
        };

        let app, auth;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div style="color: ${type === 'error' ? 'red' : type === 'success' ? 'green' : 'black'}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const className = type;
            resultsDiv.innerHTML += `<div class="${className}"><strong>${type.toUpperCase()}:</strong> ${message}</div>`;
        }

        async function initFirebase() {
            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const { getAuth } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                
                log('Firebase åˆå§‹åŒ–æˆåŠŸ', 'success');
                return true;
            } catch (error) {
                log(`Firebase åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'error');
                showResult(`Firebase åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'error');
                return false;
            }
        }

        window.testGoogleAuth = async function() {
            try {
                log('=== æ¸¬è©¦ Google ç™»å…¥ ===');
                
                if (!auth) {
                    const success = await initFirebase();
                    if (!success) return;
                }
                
                const { GoogleAuthProvider, signInWithRedirect } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                
                const provider = new GoogleAuthProvider();
                provider.addScope('email');
                provider.addScope('profile');
                
                log('ç™¼é€é‡å®šå‘è«‹æ±‚...');
                showResult('æ­£åœ¨å˜—è©¦é‡å®šå‘åˆ° Google...', 'info');
                
                await signInWithRedirect(auth, provider);
                log('é‡å®šå‘è«‹æ±‚å·²ç™¼é€', 'success');
                
            } catch (error) {
                log(`Google ç™»å…¥æ¸¬è©¦å¤±æ•—: ${error.code} - ${error.message}`, 'error');
                
                if (error.code === 'auth/unauthorized-domain') {
                    showResult('âŒ æˆæ¬Šç¶²åŸŸéŒ¯èª¤ï¼šè«‹åœ¨ Firebase Console ä¸­æ·»åŠ  hotdogcat0228.github.io åˆ°æˆæ¬Šç¶²åŸŸåˆ—è¡¨', 'error');
                } else if (error.code === 'auth/operation-not-allowed') {
                    showResult('âŒ æ“ä½œä¸å…è¨±ï¼šè«‹åœ¨ Firebase Console ä¸­å•Ÿç”¨ Google ç™»å…¥æä¾›è€…', 'error');
                } else {
                    showResult(`Google ç™»å…¥éŒ¯èª¤: ${error.message}`, 'error');
                }
            }
        };

        window.checkDomainAuth = function() {
            log('=== æª¢æŸ¥ç¶²åŸŸæˆæ¬Š ===');
            
            const currentDomain = window.location.hostname;
            const currentOrigin = window.location.origin;
            
            log(`ç•¶å‰ç¶²åŸŸ: ${currentDomain}`);
            log(`ç•¶å‰ä¾†æº: ${currentOrigin}`);
            log(`Firebase Auth Domain: ${firebaseConfig.authDomain}`);
            
            const expectedDomains = [
                'hotdogcat0228.github.io',
                'localhost',
                '127.0.0.1'
            ];
            
            if (expectedDomains.includes(currentDomain)) {
                showResult(`âœ… ç•¶å‰ç¶²åŸŸ (${currentDomain}) æ‡‰è©²è¢«æˆæ¬Š`, 'success');
                log('ç¶²åŸŸæª¢æŸ¥é€šé', 'success');
            } else {
                showResult(`âŒ ç•¶å‰ç¶²åŸŸ (${currentDomain}) å¯èƒ½æœªè¢«æˆæ¬Š`, 'error');
                log('ç¶²åŸŸæª¢æŸ¥å¤±æ•—', 'error');
            }
            
            showResult(`è«‹ç¢ºèªåœ¨ Firebase Console â†’ Authentication â†’ Settings â†’ Authorized domains ä¸­å·²æ·»åŠ : ${currentDomain}`, 'warning');
        };

        window.testDirectGoogleOAuth = function() {
            log('=== ç¹é Firebase æ¸¬è©¦ Google OAuth ===');
            
            // é€™æœƒé–‹å•Ÿ Google OAuth é é¢ï¼Œä½†ä¸æœƒå®Œæˆç™»å…¥æµç¨‹
            // ä¸»è¦æ˜¯æ¸¬è©¦ OAuth é…ç½®æ˜¯å¦æ­£ç¢º
            const baseUrl = 'https://accounts.google.com/o/oauth2/v2/auth';
            const params = new URLSearchParams({
                client_id: '656225813708', // é€™æ˜¯ä¸å®Œæ•´çš„ client_idï¼Œåƒ…ç”¨æ–¼æ¸¬è©¦
                redirect_uri: window.location.origin + window.location.pathname,
                response_type: 'code',
                scope: 'email profile',
                state: 'test_state'
            });
            
            const testUrl = `${baseUrl}?${params.toString()}`;
            log(`æ¸¬è©¦ URL: ${testUrl}`);
            
            showResult('æ­£åœ¨é–‹å•Ÿ Google OAuth æ¸¬è©¦é é¢...', 'info');
            
            // åœ¨æ–°åˆ†é é–‹å•Ÿ
            window.open(testUrl, '_blank');
            
            showResult('å¦‚æœ Google OAuth é é¢é–‹å•Ÿä½†é¡¯ç¤ºéŒ¯èª¤ï¼Œè¡¨ç¤º OAuth è¨­å®šæœ‰å•é¡Œ', 'warning');
        };

        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥
        window.addEventListener('load', () => {
            log('é é¢è¼‰å…¥å®Œæˆ');
            checkDomainAuth();
        });
    </script>
</body>
</html>
